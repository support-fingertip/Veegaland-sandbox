<apex:page controller="NameBoardController" showHeader="false" sidebar="false">
    <head>
        <title>Veegaland-NameBoard Selection</title>
        <style>
            .modal {
            background: #fff;
            width: 420px;
            padding: 30px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            font-family: 'Segoe UI', sans-serif;
            margin: 40px auto;
            }
            
            .modal-header {
            display: flex;
            justify-content: center;
            padding-bottom: 10px;
            }
            
            .modal-logo img {
            width: 120px;
            }
            
            .modal-title {
            font-size: 22px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 10px;
            display: block;
            color: #666;
            }
            
            .modal-description {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-bottom: 25px;
            }
            
            .input-field {
            width: 100%;
            padding: 17px 0;
            font-size: 21px;
            border: 1px solid #ccc;
            border-radius: 10px;
            outline: none;
            margin-bottom: 20px;
            text-align: center;
            }
            
            .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            }
            
            .btn-primary {
            margin-top: 20px !important;
            background: #0070d2 !important;
            color: #fff !important;
            border: none !important;
            padding: 12px 25px !important;
            font-size: 16px !important;
            border-radius: 6px !important;
            cursor: pointer !important;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease !important;
            }
            
            .btn-primary:hover {
            background: #005bb5 !important;
            transform: translateY(-1px);
            }
            
            
            .btn-secondary {
            margin-top: 20px !important;
            background: #f5f5f5 !important;
            color: #333 !important;
            border: 1px solid #ccc !important;
            padding: 12px 25px !important;
            font-size: 16px !important;
            font-weight: 500;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            }
            
            .btn-secondary:hover {
            background: #e0e0e0 !important;
            border-color: #bbb !important;
            }
            .small-padding{
            padding:10px 0 !important;
            font-size:18px;
            }
        </style>
        <script>
        const bookingId = "{!bookingId}";
        
        function saveNameBoard() {
            const nameValue = document.getElementById("nameBoard").value.trim();
            if (!nameValue) {
                alert("Please enter a Name Board name.");
                return;
            }
            
            NameBoardController.saveApartmentName(bookingId, nameValue, function(result, event) {
                if (event.status) {
                    if (result === 'saved') {
                        showMessage("Thank you! Apartment name saved successfully.", true);
                        document.getElementById("nameInputSection").style.display = "none";
                    } else if (result === 'alreadySelected') {
                        showMessage("Thank you! You already selected the apartment name.", true);
                        document.getElementById("nameInputSection").style.display = "none";
                    } else if (result === 'missing') {
                        showMessage("Missing booking ID or apartment name.", false);
                    } else if (result.startsWith('error:')) {
                        showMessage("Error: " + result.substring(6), false);
                    }
                } else {
                    showMessage("Error saving name: " + event.message, false);
                }
            });
        }
        
        function showMessage(msg, success) {
            const msgBox = document.getElementById("messageBox");
            msgBox.innerText = msg;
            msgBox.style.color = success ? "green" : "red";
            msgBox.style.display = "block";
        }
        </script>
    </head>
    <body>
        

  <div class="modal">
    <div class="modal-header">
        <div class="modal-logo">
            <img src="{!$Resource.veegaland}" alt="Logo" />
        </div>
    </div>

    <div class="modal-body">
        <!-- If the name is not selected yet -->
        <apex:outputPanel id="nameInputSection" rendered="{!NOT(nameAlreadySelected)}">
            <h2 class="modal-title">Enter Apartment Name</h2>
            <p class="modal-description">Please enter the apartment name to be displayed in the name board at the lobby.</p>
            <input type="text" maxlength="21" id="nameBoard" class="input-field" placeholder="Enter name here" />
        </apex:outputPanel>

        <!-- If the name has already been selected -->
        <apex:outputPanel rendered="{!nameAlreadySelected}">
            <h2 class="modal-title small-padding">Thank you for selecting the apartment name.</h2>
            <input type="text" id="selectedName" class="input-field" value="{!apartmentName}" disabled="true" />
        </apex:outputPanel>

        <div id="messageBox"></div>
    </div>

    <!-- If the name is not already selected -->
    <apex:outputPanel rendered="{!NOT(nameAlreadySelected)}">
        <div class="modal-footer">
            <button class="btn-secondary" onclick="window.close()">Cancel</button>
            <button class="btn-primary" onclick="saveNameBoard()">Save</button>
        </div>
    </apex:outputPanel>

    <!-- If the name has already been selected, show only the thank you message -->
    <apex:outputPanel rendered="{!nameAlreadySelected}">
        <div class="modal-footer">
            <button class="btn-secondary" onclick="window.close()">Close</button>
        </div>
    </apex:outputPanel>
</div>


    </body>
</apex:page>