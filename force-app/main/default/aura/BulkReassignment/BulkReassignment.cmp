<aura:component controller="BulkReassignmenController"
                implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId" access="global" >
    
    <aura:attribute name="users" type="object[]" />
    <aura:attribute name="userId" type="String" />
    <aura:attribute name="NextUserId" type="String" />
    <aura:attribute name="SEId" type="String" />
    <aura:attribute name="showUsers" type="boolean" default="false"/>
    <aura:attribute name="showFilter" type="boolean" default="false"/>
    <aura:attribute name="showFilterDate" type="boolean" default="false"/>
    <aura:attribute name="showupcoming" type="boolean" default="false"/>
    
    <aura:attribute name="spinner" type="boolean" default="false"/>
    <!-- lookup attributes -->
    <aura:attribute name="allroutes" type="object[]" default="[]"/>
    <aura:attribute name="searchText" type="string" default=""/>
    <aura:attribute name="matchUsers" type="object[]" default="[]"/>
    <aura:handler name="change" value="{!v.searchText}" action="{!c.searchText}"></aura:handler> 
    
    <!-- lookup attributes -->
    
    <aura:attribute name="searchText2" type="string" default=""/>
    <aura:attribute name="matchUsers2" type="object[]" default="[]"/>
    <aura:handler name="change" value="{!v.searchText2}" action="{!c.searchText2}"></aura:handler> 
    
    <!-- data tabel attributes -->
    
    <aura:attribute name="mydata3" type="Object"/>
    <aura:attribute name="mycolumns3" type="List"/>
    
    <aura:attribute name="mydata4" type="Object"/>
    <aura:attribute name="mycolumns4" type="List"/>
    <aura:attribute name="selectedRowsCount4" type="Integer" default="0"/>
    <aura:attribute name="selectedUsers" type="List" default="[]"/>
    <aura:attribute name="selectedRows" type="List" default="[]"/>
    
    <aura:attribute name="project" type="List" default="[]"/>
    <aura:attribute name="fieldMap" type="Map"/>
    
    
    
    <aura:attribute name="lead" type="Lead" default="{'sobjectType':'Lead', 
                                                     
                                                     'Allocated_Project__c': '','Lead_status__c': '','Leadsource__c': ''}"/>
    <aura:attribute name="CreatedDate" type="string" default=""/>
    <aura:attribute name="FilterCreatedDate" type="string" default=""/> 
    <aura:attribute name="statusFilter" type="string" default=""/>
    <aura:attribute name="projectName" type="string" default=""/>
     <aura:attribute name="leadStatus" type="string" default=""/>
    <aura:attribute name="leadSource" type="string" default=""/>
    <aura:attribute name="leadstage" type="string" default=""/>
    <aura:attribute name="FromCreatedDateFilter" type="date" default=""/>
     <aura:attribute name="ToCreatedDateFilter" type="date" default=""/>
    <aura:attribute name="fieldMap1" type="Map"/>
     <aura:attribute name="fieldMap2" type="Map"/>
    <aura:attribute name="fieldMap3" type="Map"/>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"></aura:handler>
    
    <div >
        <div class="slds-page-header">
            <div class="slds-page-header__row">
                <div class="slds-page-header__col-title slds-align-middle">
                    <div class="slds-media">
                        <div class="slds-media__figure">
                            <lightning:icon size="large" iconName="standard:record_update"/>
                        </div>
                        <div class="slds-media__body slds-align-middle"><span style="font-size:18px;font-weight: bold;">Re-Assignment</span></div>
                    </div>
                </div>
            </div>
        </div>
        <lightning:tabset variant="scoped">
            
            <lightning:tab label="Change Lead owner" >
                <div class="slds-page-body">
                    
                    <div class="slds-has-flexi-truncate">
                        <div class="slds-grid  slds-wrap slds-grid_pull-padded-xx-small slds-m-bottom--medium">
                            
                            <!--<div class="slds-size_1-of-2 slds-p-horizontal_x-small"> 
                            <lightning:select class="select"  label="Actual User Name" value="{!v.SEId}" onchange="{!c.fetchbeats}" messageWhenValueMissing="Please select this field">
                                <option value="">Select User</option>
                                <aura:iteration items="{!v.users}" var="val">
                                    <option value="{!val.Id}"> {!val.Name}</option>
                                </aura:iteration></lightning:select>
                        </div>-->
                            
                            <!--<div class="slds-size_1-of-2 slds-p-horizontal_x-small"> 
                            <lightning:select class="select"  label="Assigning To" value="{!v.NextUserId}" messageWhenValueMissing="Please select this field">
                                <option value="">Select User</option>
                                <aura:iteration items="{!v.users}" var="val">
                                    <option value="{!val.Id}"> {!val.Name}</option>
                                </aura:iteration></lightning:select>
                        </div>-->
                            
                          
                            
                            
                            <div class="slds-size_1-of-1 slds-p-horizontal_x-small"> 
                                <ul class="slds-lookup__list" role="listbox"> 
                                    <lightning:input value="{!v.searchText2}" aura:id="enter-search" name="enter-search" label="Assigning To" type="search"  messageWhenValueMissing="Select User" required="true" /><br/>                                      
                                    <aura:if isTrue="{!v.matchUsers2}">
                                        <div class="{!if(not(empty(v.matchUsers2)), 'result-buttom','')}">
                                            <aura:iteration items="{!v.matchUsers2}" var="item">
                                                <li role="presentation">
                                                    <span class="slds-lookup__item-action slds-media slds-media--center" role="option">
                                                        <div class="slds-media__body">
                                                            <div class="slds-input-has-icon slds-input-has-icon--right">
                                                                <div class="slds-lookup__result-text" data-id="{!item.Id}" onclick="{!c.update2 }">
                                                                    <a role="option" >
                                                                        <lightning:icon iconName="standard:account" size="xx-small"/>&nbsp;{!item.Name} - {!item.Profile.Name}
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </span>
                                                </li>
                                            </aura:iteration>
                                        </div>
                                    </aura:if>     
                                </ul>
                            </div>
                            <div class="slds-size_1-of-1 slds-p-horizontal_x-small"> 
                              <ul class="slds-lookup__list" role="listbox"> 
                                    <lightning:input value="{!v.searchText}" aura:id="enter-search" name="enter-search" label="Actual Owner Name" type="search"  messageWhenValueMissing="Select User"  /><br/>                                      
                                    <aura:if isTrue="{!v.matchUsers}">
                                        <div class="{!if(not(empty(v.matchUsers)), 'result-buttom','')}">
                                            <aura:iteration items="{!v.matchUsers}" var="item">
                                                <li role="presentation">
                                                    <span class="slds-lookup__item-action slds-media slds-media--center" role="option">
                                                        <div class="slds-media__body">
                                                            <div class="slds-input-has-icon slds-input-has-icon--right">
                                                                <div class="slds-lookup__result-text" data-id="{!item.Id}" onclick="{!c.update }">
                                                                    <a role="option" >
                                                                        <lightning:icon iconName="standard:account" size="xx-small"/>&nbsp;{!item.Name} - {!item.Profile.Name}
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </span>
                                                </li>
                                            </aura:iteration>
                                        </div>
                                    </aura:if>     
                                </ul>
                            </div>
                           <!-- <aura:if isTrue="{!v.showFilter}">-->
                            <div class="slds-size_1-of-6 slds-p-horizontal_x-small">
                                <lightning:select aura:id="projectPicklist" value="{!v.lead.Allocated_Project__c}" onchange="{!c.handleOnChange}" name="projectPicklist" label="project" >
                                    <option value="">--None--</option>
                                    <aura:iteration items="{!v.fieldMap}" var="i" indexVar="key">
                                        <option text="{!i.value}" value="{!i.key}" selected="{!i.key==v.lead.Allocated_Project__c}" />
                                    </aura:iteration>
                                </lightning:select>
                                
                            </div>
                            <div class="slds-size_1-of-6 slds-p-horizontal_x-small">
                       
                                
                                    <lightning:input label="From" type="date" value="{!v.FromCreatedDateFilter}" name="createdDateInput" onchange="{!c.handleOnChange}" placeholder="Created Date"/>
                               
                                </div>
                                <div class="slds-size_1-of-6 slds-p-horizontal_x-small">
                                    <lightning:input label="To" type="date" value="{!v.ToCreatedDateFilter}" name="createdDateInput" onchange="{!c.handleOnChange}" placeholder="Created Date"/>
                                    
                                </div>
                            <div class="slds-size_1-of-6 slds-p-horizontal_x-small">
                                <lightning:select aura:id="leadstatusPicklist" value="{!v.lead.Lead_status__c}" onchange="{!c.handleOnChange}" name="leadstatusPicklist" label="Lead Status" >
                                    <option value="">--None--</option>
                                    <aura:iteration items="{!v.fieldMap1}" var="i" indexVar="key">
                                        <option text="{!i.value}" value="{!i.key}" selected="{!i.key==v.lead.Lead_status__c}" />
                                    </aura:iteration>
                                </lightning:select>
                                
                            </div>
                                <div class="slds-size_1-of-6 slds-p-horizontal_x-small">
                                <lightning:select aura:id="leadSourcePicklist" value="{!v.lead.LeadSource}" onchange="{!c.handleOnChange}" name="leadSourcePicklist" label="Lead Source" >
                                    <option value="">--None--</option>
                                    <aura:iteration items="{!v.fieldMap2}" var="i" indexVar="key">
                                        <option text="{!i.value}" value="{!i.key}" selected="{!i.key==v.lead.LeadSource}" />
                                    </aura:iteration>
                                </lightning:select>
                                
                            </div>
                            <div class="slds-size_1-of-6 slds-p-horizontal_x-small">
                                <lightning:select aura:id="leadStagePicklist" value="{!v.lead.Lead_Stage__c}" onchange="{!c.handleOnChange}" name="leadStagePicklist" label="Lead Stage" >
                                    <option value="">--None--</option>
                                    <aura:iteration items="{!v.fieldMap3}" var="i" indexVar="key">
                                        <option text="{!i.value}" value="{!i.key}" selected="{!i.key==v.lead.Lead_Stage__c}" />
                                    </aura:iteration>
                                </lightning:select>
                                
                            </div>
                           <!-- </aura:if>-->
                        </div>
                    </div>
                </div>
                
                
                <aura:if isTrue="{!v.showUsers}">
                    <aura:if isTrue="{!and(v.mydata3 != '',v.mydata3 != null)}">
                        <div style="background-color:white;">
                            <center><h1 class="slds-text-align_center slds-text-heading_medium"><span style="color:maroon;"><b>Leads</b></span></h1></center>
                            
                        </div>
                         
                        <div style="height: 200px"> 
                            <h1>Selected leads: {! v.selectedRowsCount4 }</h1>
                            <lightning:datatable aura:id="lgtngCmp"
                                                 keyField="id"
                                                 data="{!v.mydata3 }"
                                                 columns="{! v.mycolumns3 }"
                                                 onrowaction="{!c.handleRowAction3 }"
                                                 onrowselection="{! c.updateSelectedText4 }"
                                                 selectedRows="{!v.selectedRows}"/>
                       
                        </div>
                        
                    </aura:if>
                    <br/>
                    
                    <div class="slds-text-align_center">
                        <button class="slds-button slds-button--brand" onclick="{!c.docancel2}" >cancel</button>
                        <aura:if isTrue="{!(v.selectedRowsCount4 != 0)}">
                            <button class="slds-button slds-button--brand" onclick="{!c.changeBeatOwner}" >Change Lead Owner</button>
                        </aura:if>
                    </div>
                </aura:if>
                
                <aura:if isTrue="{!v.spinner}">
                    <lightning:spinner class="spins" size="medium" variant="brand"  alternativeText="Loading" />
                   
                </aura:if>
                
                
                
                
            </lightning:tab>
            
        </lightning:tabset>
        
        
        
        
    </div>
    
    
    
</aura:component>